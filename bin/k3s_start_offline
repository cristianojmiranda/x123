#!/bin/bash
source env.sh

#set -x
echo $_K3S_IMAGES
mkdir -p $_K3S_IMAGES

read -p "Pull images from internet? [y/n]" answer

#k3s_images
if [[ "$answer" == "y" ]]; then
  echo "Pulling images..."
  docker pull traefik:1.7.9
  docker pull coredns/coredns:1.3.0
  docker pull rancher/klipper-lb:v0.1.1
  docker pull rancher/klipper-helm:v0.1.5
  docker pull busybox
  docker pull k8s.gcr.io/pause:3.1
  #docker pull quay.io/kubernetes_incubator/nfs-provisioner
fi

echo "Pushing images..."
docker save traefik -o $_K3S_IMAGES/traefik.tar
docker save coredns/coredns -o $_K3S_IMAGES/coredns.tar
docker save rancher/klipper-lb -o $_K3S_IMAGES/klipper-lb.tar
docker save rancher/klipper-helm -o $_K3S_IMAGES/klipper-helm.tar
docker save busybox -o $_K3S_IMAGES/busybox.tar
docker save k8s.gcr.io/pause:3.1 -o $_K3S_IMAGES/pause.tar

docker save vault -o $_K3S_IMAGES/vault.tar
docker save consul -o $_K3S_IMAGES/consul.tar
docker save rabbitmq -o $_K3S_IMAGES/rabbitmq.tar
#docker save quay.io/kubernetes_incubator/nfs-provisioner -o $_K3S_IMAGES/nfs-provisioner.tar

ls -lh $_K3S_IMAGES

start_k3s
