#!/bin/bash
source env.sh

mkdir /tmp/images

#docker pull traefik:1.7.9
#docker pull coredns/coredns:1.3.0
#docker pull rancher/klipper-lb:v0.1.1
#docker pull rancher/klipper-helm:v0.1.3

docker save traefik -o /tmp/images/traefik.tar
docker save coredns/coredns -o /tmp/images/coredns.tar
docker save rancher/klipper-lb -o /tmp/images/klipper-lb.tar
docker save rancher/klipper-helm -o /tmp/images/klipper-helm.tar

docker save vault -o /tmp/images/vault.tar
docker save consul -o /tmp/images/consul.tar
docker save vault -o /tmp/images/rabbitmq.tar
ls -lh /tmp/images/

start_k3s
#kkn kube-system edit jobs helm-install-traefik
kkn kube-system get jobs helm-install-traefik -o yaml | sed -e 's/imagePullPolicy:.*/imagePullPolicy: IfNotPresent/g' | kubectl -n kube-system apply --force=true --filename -
